export default class{constructor(){this.ERROR_MISSING_CALLBACK="Callback function is missing!",this._slice=Array.prototype.slice,this._listeners=[],this._dispatchCount=0}_sort(t){t.sort((function(t,s){return t=t.p,(s=s.p)<t?1:s>t?-1:0}))}add(t,s,i,e){if(!t)throw this.ERROR_MISSING_CALLBACK;i=i||0;let l,r,n,h=this._listeners,c=h.length;for(;c--;)if(l=h[c],l.f===t&&l.c===s)return!1;"function"==typeof i&&(r=i,i=e,n=4),h.unshift({f:t,c:s,p:i,r:r||t,a:this._slice.call(arguments,n||3),j:0}),this._sort(h)}addOnce(t,s,i,e){if(!t)throw this.ERROR_MISSING_CALLBACK;let l=this;1===(e=this._slice.call(arguments,0)).length&&e.push(void 0),e.splice(2,0,(function(){return l.remove.call(l,t,s),t.apply(s,l._slice.call(arguments,0))})),this.add.apply(l,e)}remove(t,s){if(!t)return this._listeners.length=0,!0;let i,e=this._listeners,l=e.length;for(;l--;)if(i=e[l],i.f===t&&(!s||i.c===s))return i.j=0,e.splice(l,1),!0;return!1}dispatch(t){t=this._slice.call(arguments,0),this._dispatchCount+=1;let s,i,e=this._dispatchCount,l=this._listeners,r=l.length;for(;r--;)if(s=l[r],s&&s.j<e&&(s.j=e,!1===s.r.apply(s.c,s.a.concat(t)))){i=s;break}for(l=this._listeners,r=l.length;r--;)l[r].j=0;return i}}
